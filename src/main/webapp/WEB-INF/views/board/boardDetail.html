<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <title>모바일 게시판</title>

    <!-- Bootstrap 및 아이콘 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <!-- 커스텀 CSS -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/boardDetail.css}">

</head>
<body>

<div class="mobile-view">
    <div class="back-view">
        <div class="container">
            <!-- 뒤로가기 -->
            <div class="d-flex align-items-center mb-3">
                <a th:href="@{/board/list}" class="me-2 text-dark">
                    <i class="bi bi-arrow-left fs-4"></i>
                </a>
                <h4 class="m-0">게시판</h4>
            </div>

            <!-- 게시글 -->
            <div class="card p-3">
                <div class="d-flex align-items-center">
                    <img th:src="@{/images/profile-icon/1.jpg}" class="profile-img me-2" alt="프로필">
                    <div>
                        <strong th:text="${board.nickname}">하리보</strong>
                        <p class="mb-1" th:text="${board.title}">안녕하세요</p>
                        <small class="text-muted" th:text="${board.content}">안녕하세요! 오늘 가입했어요</small>
                    </div>
                </div>
                <div class="mt-2">
                    <button style="background: none; border: none; padding: 0;">
                        <i id="likeBtn" th:class="${checkLikeExists} ? 'bi bi-heart-fill' : 'bi bi-heart'"></i>
                    </button>
                    <span id="heartCount" th:text="${board.heart_count}">1</span>
                    <i class="bi bi-chat-dots"></i> <span th:text="${board.comment_count}">1</span>
                    <span class="ms-2 text-muted" th:text="${board.created_at}">25-02-05 16:06</span>
                </div>
            </div>

            <!-- 댓글 리스트로 받아와서 each 함수를 이용하여 출력-->
            <div class="comment-box mt-2" th:each="comment : ${commentList}">
                <div class="d-flex align-items-center">
                    <img th:src="@{/images/profile-icon/1.jpg}" class="profile-img me-2" alt="프로필">
                    <div>
                        <strong th:text="${comment.nickname}">치킨</strong>
                        <p class="mb-1" th:text="${comment.content}">안녕하세요!</p>
                        <small class="text-muted" th:text="${comment.createdAt}">25-02-05 16:18</small>
                    </div>
                </div>
            </div>
        </div>

            <!-- 댓글 입력창 -->
            <div class="input-box">
                <input type="text" class="form-control me-2" placeholder="댓글을 달아주세요">
                <button class="btn btn-primary">전송</button>
            </div>

            <!-- footer.html 포함 -->
            <div th:replace="fragments/footer.html :: footer" />
    </div>
</div>
<script th:inline="javascript">
    // 모델로 지정한 값 직접 가져오기
    const user_Id = /*[[${session.user}]]*/ null; //세션에 있는 유저아이디 주입
    const board_Id = [[${board.id}]]; //게시판 보드아이디
    //좋아요 카운트 범위 가져오기
    const heartCountSpan = document.getElementById("heartCount");

    // DOMContentLoaded를 넣어서 DOM이 모두 Load된 후 해당 Action이 작동되도록 설정.
    document.addEventListener('DOMContentLoaded', function() {
    const likeBtn = document.querySelector('#likeBtn');

    likeBtn.addEventListener('click', async function (e) {
    e.preventDefault(); // 기본 동작 방지

        try {
            const response = await fetch('/blindtime/board/like', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json' // JSON 데이터임을 명시
                },
                body: JSON.stringify({
                    "user_id": user_Id,
                    "board_id": board_Id
                })
            });

            if (response.ok) {
                const data = await response.json(); // JSON 응답 받기
                heartCountSpan.textContent = data.heartCount; // 좋아요 개수 업데이트

                // 아이콘 클래스 토글
                likeBtn.classList.toggle('bi-heart-fill',!data.liked);
                likeBtn.classList.toggle('bi-heart',data.liked);
            }
        } catch (error) {
            console.error('Error:', error);
        }
    });

    });
</script>
</body>
</html>
